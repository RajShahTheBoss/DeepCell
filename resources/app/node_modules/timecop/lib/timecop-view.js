Object.defineProperty(exports, '__esModule', {
  value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _templateObject = _taggedTemplateLiteral(['\n      Loaded ', ' packages in ', 'ms.\n      ', ' took longer than 5ms to load.\n    '], ['\n      Loaded ', ' packages in ', 'ms.\n      ', ' took longer than 5ms to load.\n    ']),
    _templateObject2 = _taggedTemplateLiteral(['\n      Activated ', ' packages in ', 'ms.\n      ', ' took longer than 5ms to activate.    '], ['\n      Activated ', ' packages in ', 'ms.\n      ', ' took longer than 5ms to activate.\\\n    ']),
    _templateObject3 = _taggedTemplateLiteral(['\n      Loaded ', ' themes in ', 'ms.\n      ', ' took longer than 5ms to load.    '], ['\n      Loaded ', ' themes in ', 'ms.\n      ', ' took longer than 5ms to load.\\\n    ']),
    _templateObject4 = _taggedTemplateLiteral(['\n      Activated ', ' themes in ', 'ms.\n      ', ' took longer than 5ms to activate.    '], ['\n      Activated ', ' themes in ', 'ms.\n      ', ' took longer than 5ms to activate.\\\n    ']);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }

/** @babel */
/** @jsx etch.dom */

var _underscorePlus = require('underscore-plus');

var _underscorePlus2 = _interopRequireDefault(_underscorePlus);

var _dedent = require('dedent');

var _dedent2 = _interopRequireDefault(_dedent);

var _atom = require('atom');

var _etch = require('etch');

var _etch2 = _interopRequireDefault(_etch);

var _cachePanelView = require('./cache-panel-view');

var _cachePanelView2 = _interopRequireDefault(_cachePanelView);

var _packagePanelView = require('./package-panel-view');

var _packagePanelView2 = _interopRequireDefault(_packagePanelView);

var _windowPanelView = require('./window-panel-view');

var _windowPanelView2 = _interopRequireDefault(_windowPanelView);

var TimecopView = (function () {
  function TimecopView(_ref) {
    var _this = this;

    var uri = _ref.uri;

    _classCallCheck(this, TimecopView);

    this.uri = uri;
    _etch2['default'].initialize(this);
    if (atom.packages.getActivePackages().length > 0) {
      this.populateViews();
    } else {
      // Render on next tick so packages have been activated
      setImmediate(function () {
        _this.populateViews();
      });
    }
  }

  _createClass(TimecopView, [{
    key: 'update',
    value: function update() {}
  }, {
    key: 'destroy',
    value: function destroy() {
      return _etch2['default'].destroy(this);
    }
  }, {
    key: 'render',
    value: function render() {
      return _etch2['default'].dom(
        'div',
        { className: 'timecop pane-item native-key-bindings', tabIndex: '-1' },
        _etch2['default'].dom(
          'div',
          { className: 'timecop-panel' },
          _etch2['default'].dom(
            'div',
            { className: 'panels' },
            _etch2['default'].dom(_windowPanelView2['default'], { ref: 'windowLoadingPanel' }),
            _etch2['default'].dom(_cachePanelView2['default'], { ref: 'cacheLoadingPanel' })
          ),
          _etch2['default'].dom(
            'div',
            { className: 'panels' },
            _etch2['default'].dom(_packagePanelView2['default'], { ref: 'packageLoadingPanel', title: 'Package Loading' }),
            _etch2['default'].dom(_packagePanelView2['default'], { ref: 'packageActivationPanel', title: 'Package Activation' }),
            _etch2['default'].dom(_packagePanelView2['default'], { ref: 'themeLoadingPanel', title: 'Theme Loading' }),
            _etch2['default'].dom(_packagePanelView2['default'], { ref: 'themeActivationPanel', title: 'Theme Activation' })
          )
        )
      );
    }
  }, {
    key: 'populateViews',
    value: function populateViews() {
      this.refs.windowLoadingPanel.populate();
      this.refs.cacheLoadingPanel.populate();
      this.showLoadedPackages();
      this.showActivePackages();
      this.showLoadedThemes();
      this.showActiveThemes();
    }
  }, {
    key: 'showLoadedPackages',
    value: function showLoadedPackages() {
      var _getSlowPackages = this.getSlowPackages(atom.packages.getLoadedPackages().filter(function (pack) {
        return pack.getType() !== 'theme';
      }), 'loadTime');

      var time = _getSlowPackages.time;
      var count = _getSlowPackages.count;
      var packages = _getSlowPackages.packages;

      this.refs.packageLoadingPanel.addPackages(packages, 'loadTime');
      this.refs.packageLoadingPanel.refs.summary.textContent = (0, _dedent2['default'])(_templateObject, count, time, _underscorePlus2['default'].pluralize(packages.length, 'package'));
    }
  }, {
    key: 'showActivePackages',
    value: function showActivePackages() {
      var _getSlowPackages2 = this.getSlowPackages(atom.packages.getActivePackages().filter(function (pack) {
        return pack.getType() !== 'theme';
      }), 'activateTime');

      var time = _getSlowPackages2.time;
      var count = _getSlowPackages2.count;
      var packages = _getSlowPackages2.packages;

      this.refs.packageActivationPanel.addPackages(packages, 'activateTime');
      this.refs.packageActivationPanel.refs.summary.textContent = (0, _dedent2['default'])(_templateObject2, count, time, _underscorePlus2['default'].pluralize(packages.length, 'package'));
    }
  }, {
    key: 'showLoadedThemes',
    value: function showLoadedThemes() {
      var _getSlowPackages3 = this.getSlowPackages(atom.themes.getLoadedThemes(), 'loadTime');

      var time = _getSlowPackages3.time;
      var count = _getSlowPackages3.count;
      var packages = _getSlowPackages3.packages;

      this.refs.themeLoadingPanel.addPackages(packages, 'loadTime');
      this.refs.themeLoadingPanel.refs.summary.textContent = (0, _dedent2['default'])(_templateObject3, count, time, _underscorePlus2['default'].pluralize(packages.length, 'theme'));
    }
  }, {
    key: 'showActiveThemes',
    value: function showActiveThemes() {
      var _getSlowPackages4 = this.getSlowPackages(atom.themes.getActiveThemes(), 'activateTime');

      var time = _getSlowPackages4.time;
      var count = _getSlowPackages4.count;
      var packages = _getSlowPackages4.packages;

      this.refs.themeActivationPanel.addPackages(packages, 'activateTime');
      this.refs.themeActivationPanel.refs.summary.textContent = (0, _dedent2['default'])(_templateObject4, count, time, _underscorePlus2['default'].pluralize(packages.length, 'theme'));
    }
  }, {
    key: 'getSlowPackages',
    value: function getSlowPackages(packages, timeKey) {
      var time = 0;
      var count = 0;
      packages = packages.filter(function (pack) {
        time += pack[timeKey];
        count++;
        return pack[timeKey] > 5;
      });
      packages.sort(function (pack1, pack2) {
        return pack2[timeKey] - pack1[timeKey];
      });
      return { time: time, count: count, packages: packages };
    }
  }, {
    key: 'serialize',
    value: function serialize() {
      return {
        deserializer: this.constructor.name,
        uri: this.getURI()
      };
    }
  }, {
    key: 'getURI',
    value: function getURI() {
      return this.uri;
    }
  }, {
    key: 'getTitle',
    value: function getTitle() {
      return 'Timecop';
    }
  }, {
    key: 'getIconName',
    value: function getIconName() {
      return 'dashboard';
    }
  }, {
    key: 'onDidChangeTitle',
    value: function onDidChangeTitle() {
      return new _atom.Disposable(function () {});
    }
  }, {
    key: 'onDidChangeModified',
    value: function onDidChangeModified() {
      return new _atom.Disposable(function () {});
    }
  }]);

  return TimecopView;
})();

exports['default'] = TimecopView;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vQzovcHJvamVjdHMvYXRvbS9vdXQvYXBwL25vZGVfbW9kdWxlcy90aW1lY29wL2xpYi90aW1lY29wLXZpZXcuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OEJBR2MsaUJBQWlCOzs7O3NCQUNaLFFBQVE7Ozs7b0JBQ0YsTUFBTTs7b0JBQ2QsTUFBTTs7Ozs4QkFDSSxvQkFBb0I7Ozs7Z0NBQ2xCLHNCQUFzQjs7OzsrQkFDdkIscUJBQXFCOzs7O0lBRTVCLFdBQVc7QUFDbEIsV0FETyxXQUFXLENBQ2pCLElBQUssRUFBRTs7O1FBQU4sR0FBRyxHQUFKLElBQUssQ0FBSixHQUFHOzswQkFERSxXQUFXOztBQUU1QixRQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQTtBQUNkLHNCQUFLLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUNyQixRQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ2hELFVBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQTtLQUNyQixNQUFNOztBQUVMLGtCQUFZLENBQUMsWUFBTTtBQUFFLGNBQUssYUFBYSxFQUFFLENBQUE7T0FBRSxDQUFDLENBQUE7S0FDN0M7R0FDRjs7ZUFWa0IsV0FBVzs7V0FZdkIsa0JBQUcsRUFBRTs7O1dBRUosbUJBQUc7QUFDVCxhQUFPLGtCQUFLLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtLQUMxQjs7O1dBRU0sa0JBQUc7QUFDUixhQUNFOztVQUFLLFNBQVMsRUFBQyx1Q0FBdUMsRUFBQyxRQUFRLEVBQUMsSUFBSTtRQUNsRTs7WUFBSyxTQUFTLEVBQUMsZUFBZTtVQUM1Qjs7Y0FBSyxTQUFTLEVBQUMsUUFBUTtZQUNyQixzREFBaUIsR0FBRyxFQUFDLG9CQUFvQixHQUFHO1lBQzVDLHFEQUFnQixHQUFHLEVBQUMsbUJBQW1CLEdBQUc7V0FDdEM7VUFDTjs7Y0FBSyxTQUFTLEVBQUMs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bkMsV0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUU7T0FDbkIsQ0FBQTtLQUNGOzs7V0FFTSxrQkFBRztBQUNSLGFBQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQTtLQUNoQjs7O1dBRVEsb0JBQUc7QUFDVixhQUFPLFNBQVMsQ0FBQTtLQUNqQjs7O1dBRVcsdUJBQUc7QUFDYixhQUFPLFdBQVcsQ0FBQTtLQUNuQjs7O1dBRWdCLDRCQUFHO0FBQ2xCLGFBQU8scUJBQWUsWUFBWSxFQUFFLENBQUMsQ0FBQTtLQUN0Qzs7O1dBRW1CLCtCQUFHO0FBQ3JCLGFBQU8scUJBQWUsWUFBWSxFQUFFLENBQUMsQ0FBQTtLQUN0Qzs7O1NBN0hrQixXQUFXOzs7cUJBQVgsV0FBVyIsImZpbGUiOiJmaWxlOi8vL0M6L3Byb2plY3RzL2F0b20vb3V0L2FwcC9ub2RlX21vZHVsZXMvdGltZWNvcC9saWIvdGltZWNvcC12aWV3LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBiYWJlbCAqL1xuLyoqIEBqc3ggZXRjaC5kb20gKi9cblxuaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZS1wbHVzJ1xuaW1wb3J0IGRlZGVudCBmcm9tICdkZWRlbnQnXG5pbXBvcnQge0Rpc3Bvc2FibGV9IGZyb20gJ2F0b20nXG5pbXBvcnQgZXRjaCBmcm9tICdldGNoJ1xuaW1wb3J0IENhY2hlUGFuZWxWaWV3IGZyb20gJy4vY2FjaGUtcGFuZWwtdmlldydcbmltcG9ydCBQYWNrYWdlUGFuZWxWaWV3IGZyb20gJy4vcGFja2FnZS1wYW5lbC12aWV3J1xuaW1wb3J0IFdpbmRvd1BhbmVsVmlldyBmcm9tICcuL3dpbmRvdy1wYW5lbC12aWV3J1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaW1lY29wVmlldyB7XG4gIGNvbnN0cnVjdG9yICh7dXJpfSkge1xuICAgIHRoaXMudXJpID0gdXJpXG4gICAgZXRjaC5pbml0aWFsaXplKHRoaXMpXG4gICAgaWYgKGF0b20ucGFja2FnZXMuZ2V0QWN0aXZlUGFja2FnZXMoKS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnBvcHVsYXRlVmlld3MoKVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZW5kZXIgb24gbmV4dCB0aWNrIHNvIHBhY2thZ2VzIGhhdmUgYmVlbiBhY3RpdmF0ZWRcbiAgICAgIHNldEltbWVkaWF0ZSgoKSA9PiB7IHRoaXMucG9wdWxhdGVWaWV3cygpIH0pXG4gICAgfVxuICB9XG5cbiAgdXBkYXRlICgpIHt9XG5cbiAgZGVzdHJveSAoKSB7XG4gICAgcmV0dXJuIGV0Y2guZGVzdHJveSh0aGlzKVxuICB9XG5cbiAgcmVuZGVyICgpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9J3RpbWVjb3AgcGFuZS1pdGVtIG5hdGl2ZS1rZXktYmluZGluZ3MnIHRhYkluZGV4PSctMSc+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPSd0aW1lY29wLXBhbmVsJz5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ncGFuZWxzJz5cbiAgICAgICAgICAgIDxXaW5kb3dQYW5lbFZpZXcgcmVmPSd3aW5kb3dMb2FkaW5nUGFuZWwnIC8+XG4gICAgICAgICAgICA8Q2FjaGVQYW5lbFZpZXcgcmVmPSdjYWNoZUxvYWRpbmdQYW5lbCcgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ncGFuZWxzJz5cbiAgICAgICAgICAgIDxQYWNrYWdlUGFuZWxWaWV3IHJlZj0ncGFja2FnZUxvYWRpbmdQYW5lbCcgdGl0bGU9J1BhY2thZ2UgTG9hZGluZycgLz5cbiAgICAgICAgICAgIDxQYWNrYWdlUGFuZWxWaWV3IHJlZj0ncGFja2FnZUFjdGl2YXRpb25QYW5lbCcgdGl0bGU9J1BhY2thZ2UgQWN0aXZhdGlvbicgLz5cbiAgICAgICAgICAgIDxQYWNrYWdlUGFuZWxWaWV3IHJlZj0ndGhlbWVMb2FkaW5nUGFuZWwnIHRpdGxlPSdUaGVtZSBMb2FkaW5nJyAvPlxuICAgICAgICAgICAgPFBhY2thZ2VQYW5lbFZpZXcgcmVmPSd0aGVtZUFjdGl2YXRpb25QYW5lbCcgdGl0bGU9J1RoZW1lIEFjdGl2YXRpb24nIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKVxuICB9XG5cbiAgcG9wdWxhdGVWaWV3cyAoKSB7XG4gICAgdGhpcy5yZWZzLndpbmRvd0xvYWRpbmdQYW5lbC5wb3B1bGF0ZSgpXG4gICAgdGhpcy5yZWZzLmNhY2hlTG9hZGluZ1BhbmVsLnBvcHVsYXRlKClcbiAgICB0aGlzLnNob3dMb2FkZWRQYWNrYWdlcygpXG4gICAgdGhpcy5zaG93QWN0aXZlUGFja2FnZXMoKVxuICAgIHRoaXMuc2hvd0xvYWRlZFRoZW1lcygpXG4gICAgdGhpcy5zaG93QWN0aXZlVGhlbWVzKClcbiAgfVxuXG4gIHNob3dMb2FkZWRQYWNrYWdlcyAoKSB7XG4gICAgY29uc3Qge3RpbWUsIGNvdW50LCBwYWNrYWdlc30gPSB0aGlzLmdldFNsb3dQYWNrYWdlcyhcbiAgICAgIGF0b20ucGFja2FnZXMuZ2V0TG9hZGVkUGFja2FnZXMoKS5maWx0ZXIocGFjayA9PiBwYWNrLmdldFR5cGUoKSAhPT0gJ3RoZW1lJyksXG4gICAgICAnbG9hZFRpbWUnXG4gICAgKVxuICAgIHRoaXMucmVmcy5wYWNrYWdlTG9hZGluZ1BhbmVsLmFkZFBhY2thZ2VzKHBhY2thZ2VzLCAnbG9hZFRpbWUnKVxuICAgIHRoaXMucmVmcy5wYWNrYWdlTG9hZGluZ1BhbmVsLnJlZnMuc3VtbWFyeS50ZXh0Q29udGVudCA9IGRlZGVudGBcbiAgICAgIExvYWRlZCAke2NvdW50fSBwYWNrYWdlcyBpbiAke3RpbWV9bXMuXG4gICAgICAke18ucGx1cmFsaXplKHBhY2thZ2VzLmxlbmd0aCwgJ3BhY2thZ2UnKX0gdG9vayBsb25nZXIgdGhhbiA1bXMgdG8gbG9hZC5cbiAgICBgXG4gIH1cblxuICBzaG93QWN0aXZlUGFja2FnZXMgKCkge1xuICAgIGNvbnN0IHt0aW1lLCBjb3VudCwgcGFja2FnZXN9ID0gdGhpcy5nZXRTbG93UGFja2FnZXMoXG4gICAgICBhdG9tLnBhY2thZ2VzLmdldEFjdGl2ZVBhY2thZ2VzKCkuZmlsdGVyKHBhY2sgPT4gcGFjay5nZXRUeXBlKCkgIT09ICd0aGVtZScpLFxuICAgICAgJ2FjdGl2YXRlVGltZSdcbiAgICApXG4gICAgdGhpcy5yZWZzLnBhY2thZ2VBY3RpdmF0aW9uUGFuZWwuYWRkUGFja2FnZXMocGFja2FnZXMsICdhY3RpdmF0ZVRpbWUnKVxuICAgIHRoaXMucmVmcy5wYWNrYWdlQWN0aXZhdGlvblBhbmVsLnJlZnMuc3VtbWFyeS50ZXh0Q29udGVudCA9IGRlZGVudGBcbiAgICAgIEFjdGl2YXRlZCAke2NvdW50fSBwYWNrYWdlcyBpbiAke3RpbWV9bXMuXG4gICAgICAke18ucGx1cmFsaXplKHBhY2thZ2VzLmxlbmd0aCwgJ3BhY2thZ2UnKX0gdG9vayBsb25nZXIgdGhhbiA1bXMgdG8gYWN0aXZhdGUuXFxcbiAgICBgXG4gIH1cblxuICBzaG93TG9hZGVkVGhlbWVzICgpIHtcbiAgICBjb25zdCB7dGltZSwgY291bnQsIHBhY2thZ2VzfSA9IHRoaXMuZ2V0U2xvd1BhY2thZ2VzKGF0b20udGhlbWVzLmdldExvYWRlZFRoZW1lcygpLCAnbG9hZFRpbWUnKVxuICAgIHRoaXMucmVmcy50aGVtZUxvYWRpbmdQYW5lbC5hZGRQYWNrYWdlcyhwYWNrYWdlcywgJ2xvYWRUaW1lJylcbiAgICB0aGlzLnJlZnMudGhlbWVMb2FkaW5nUGFuZWwucmVmcy5zdW1tYXJ5LnRleHRDb250ZW50ID0gZGVkZW50YFxuICAgICAgTG9hZGVkICR7Y291bnR9IHRoZW1lcyBpbiAke3RpbWV9bXMuXG4gICAgICAke18ucGx1cmFsaXplKHBhY2thZ2VzLmxlbmd0aCwgJ3RoZW1lJyl9IHRvb2sgbG9uZ2VyIHRoYW4gNW1zIHRvIGxvYWQuXFxcbiAgICBgXG4gIH1cblxuICBzaG93QWN0aXZlVGhlbWVzICgpIHtcbiAgICBjb25zdCB7dGltZSwgY291bnQsIHBhY2thZ2VzfSA9IHRoaXMuZ2V0U2xvd1BhY2thZ2VzKGF0b20udGhlbWVzLmdldEFjdGl2ZVRoZW1lcygpLCAnYWN0aXZhdGVUaW1lJylcbiAgICB0aGlzLnJlZnMudGhlbWVBY3RpdmF0aW9uUGFuZWwuYWRkUGFja2FnZXMocGFja2FnZXMsICdhY3RpdmF0ZVRpbWUnKVxuICAgIHRoaXMucmVmcy50aGVtZUFjdGl2YXRpb25QYW5lbC5yZWZzLnN1bW1hcnkudGV4dENvbnRlbnQgPSBkZWRlbnRgXG4gICAgICBBY3RpdmF0ZWQgJHtjb3VudH0gdGhlbWVzIGluICR7dGltZX1tcy5cbiAgICAgICR7Xy5wbHVyYWxpemUocGFja2FnZXMubGVuZ3RoLCAndGhlbWUnKX0gdG9vayBsb25nZXIgdGhhbiA1bXMgdG8gYWN0aXZhdGUuXFxcbiAgICBgXG4gIH1cblxuICBnZXRTbG93UGFja2FnZXMgKHBhY2thZ2VzLCB0aW1lS2V5KSB7XG4gICAgbGV0IHRpbWUgPSAwXG4gICAgbGV0IGNvdW50ID0gMFxuICAgIHBhY2thZ2VzID0gcGFja2FnZXMuZmlsdGVyKGZ1bmN0aW9uIChwYWNrKSB7XG4gICAgICB0aW1lICs9IHBhY2tbdGltZUtleV1cbiAgICAgIGNvdW50KytcbiAgICAgIHJldHVybiBwYWNrW3RpbWVLZXldID4gNVxuICAgIH0pXG4gICAgcGFja2FnZXMuc29ydCgocGFjazEsIHBhY2syKSA9PiBwYWNrMlt0aW1lS2V5XSAtIHBhY2sxW3RpbWVLZXldKVxuICAgIHJldHVybiB7dGltZSwgY291bnQsIHBhY2thZ2VzfVxuICB9XG5cbiAgc2VyaWFsaXplICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZGVzZXJpYWxpemVyOiB0aGlzLmNvbnN0cnVjdG9yLm5hbWUsXG4gICAgICB1cmk6IHRoaXMuZ2V0VVJJKClcbiAgICB9XG4gIH1cblxuICBnZXRVUkkgKCkge1xuICAgIHJldHVybiB0aGlzLnVyaVxuICB9XG5cbiAgZ2V0VGl0bGUgKCkge1xuICAgIHJldHVybiAnVGltZWNvcCdcbiAgfVxuXG4gIGdldEljb25OYW1lICgpIHtcbiAgICByZXR1cm4gJ2Rhc2hib2FyZCdcbiAgfVxuXG4gIG9uRGlkQ2hhbmdlVGl0bGUgKCkge1xuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZShmdW5jdGlvbiAoKSB7fSlcbiAgfVxuXG4gIG9uRGlkQ2hhbmdlTW9kaWZpZWQgKCkge1xuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZShmdW5jdGlvbiAoKSB7fSlcbiAgfVxufVxuIl19